# 비단락 논리 연산자 사용
자바는 and와 or 연산자를 각각 두 가지 형태로 제공한다.  
`단락 연산자(short-circuit operation)`인 `&&`와 `||`는 다음 피연산자가 연산 결과에 영향을 미치지 않을 경우 해당 피연산자를 평가하지 않는다.   
반면 `비단락 연산자(non-short-circuit operation)`인 `&`와 `|` 연산자는 중간 결과에 상관없이 모든 피연산자를 평가한다.     

대부분의 경우 단란 논리 연산 쪽이 훨씬 자연스럽고 권장할 만하다.   
실수로 비단락 연산자를 쓴다 하더라도 컴파일 에러가 발생하지 않는다.

```java
boolean isPositive(int[] data, int index) {
    return index >= 0 && index < data.length & data[index] > 0;
}
```
이 코드는 두 번째 연산자의 오타로 인해 이후 경계 조건 검사가 의도한대로 작동하지 않는다.
index가 배열의 길이를 초과해도 평가를 멈추지 않고 배열을 조회하려 시도한다.
ArrayIndexOutOfBoundsException이 발생한다.

```java
interface First {}
interface Second {}
interface Third {}
interface Exclude extends Second {}

boolean checkObject(Object obj) {
    return obj instanceof First && checkFirst((First) obj) |
            obj instanceof Second && !(obj instanceof Exclude) ||
            obj instanceof Third && checkThird((Third) obj);
}
```
비단락 논리 연산자는 단락 연산자보다 우선순위가 높으므로 전체 조건식은 다음과 같은 구조로 평가 된다.

```java
boolean checkObject(Object obj) {
    return (obj instanceof First && 
            (checkObject((First) obj) | obj instanceof Second) && 
            !(obj instanceof Exclude)) || 
            (obj instanceof Third && checkThird((Third) obj));
}
```

* 프로그래머가 의도한 조건     
(obj instanceof First && checkFirst((First) obj)) |     
obj instanceof Second && !(obj instanceof Exclude) ||     
obj instanceof Third && checkThird((Third) obj)

* 컴파일러가 이해한 조건   
(obj instanceof First && (checkFirst((First) obj) | obj instanceof Second) && !(obj instanceof Exclude)) ||   
obj instance Third && checkThird((Third) obj)
  
> 실수 방지 가이드

* 비단락 논리 연산자를 사용하지 않는다. 불필요한 추가 계산을 유발하며, 이전 조건의 영향을 받는다면 실수로 이어질 것이다.
* 복합 할당 연산자인 `&=`과 `|=`는 단락되지 않는다.
* `&&`와 `||` 연산자가 혼재하는 복잡한 조건에서는 자바의 연산자 우선순위를 알고 있다 해도 명시적으로 괄호를 사용한다.
* 다양한 연산자가 포함된 복잡한 조건은 일부분을 추출한다. 중간 변수, 메서드 추출, 여러 개의 구문으로 나누는 방법이 있다.
```java
if (obj instanceof First) {
    return checkFirst((First) obj);
}

if (obj instanceof Second) {
    return !(obj instanceof Exclude); 
}

if (obj instanceof Third) {
    return checkThird((Third) obj);
}

return false;
```
```java
// 자바 21부터는 switch 문도 패턴 매칭을 지원
return switch (obj) {
    case First first -> checkFirst(first);
    case Second second -> !(second instanceof Exclude);
    case Third third -> checkThird(third);
    case null, default -> false;
}
```


