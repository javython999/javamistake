# 비교자의 난수 반환
자바 스트림 API는 스트림 내용을 뒤섞는 메서드를 제공하지 않는다.
그러나 `sorted()` 메서드로 정렬할 수 있다.
`sorted()`로 스트림을 섞는 방식이 마음에 들지 않는다면, 다음과 같이 비교자에서 간단한게 무작위 값을 반환하면 된다.

```java
List<Integer> input = IntStream.range(0, 20)
        .boxed()
        .collect(Collectors.toList());

List<Integer> suffled = input.stream()
        .sorted( (a, b) -> Math.random() > 0.5 ? 1 : -1 )
        .collect(Collectors.toList());
```

이 코드는 일단 잘 작동한다. `input` 리스트는 0부터 19까지의 숫자를 오름차순으로 담고 있으며 `shuffled` 리스트는 같은 숫자를 뒤섞은 상태로 담게 된다.
하지만 이 코드에서 20을 32 이상으로 변경하면 가끔 `IllegalArgumentException`이 발생할 것이다.
당연히, 정렬 메서드를 잘못 사용했기 때문이다.

어떻게든 계약 위반 없이 스트림을 무작위로 정렬하고 싶다면, 다음과 같이 입력 객체에 무작위 순서를 할당하고 이를 맵에 기억시켜두면 된다.
```java
Map<Object, Double> ranks = new HashMap<>();
List<Integer> shuffled = input.stream()
        .sorted(Comparator.comparingDouble(
                val -> ranks.computeIfAbsent(val, v -> Math.random())))
        .collect(Collectors.toList());
```
그러나 이 방법은 명백히 비효율적이다. 차라리 스트림을 리스트로 수집한 다음 `Collections.shuffle()` 메서드로 섞는 것이 낫다.

> 실수 방지 가이드
* 정렬을 이용해 객체를 무작위 순서로 섞지 않는다. 정렬과 셔플은 서로 다른 알고리즘이며 한 쪽이 다른 쪽을 표현할 수 없다.
`Collections.shuffle()` 등의 전용 메서드를 사용하라.
* 원래의 용도와 다른 방식으로 정렬 연산을 오용하지 않는다. 예를 들어, (a, b) -> -1 비교자로 역순 정렬을 구현한 코드를 본 적이 있다.
이 코드는 현재 자바 버전에서는 작동하지만 향후 버전에서도 그럴지 장담할 수 없다. 
정렬 구현 방식이 변경될 가능성이 있기 때문이다. 만일 자바 버전이 업데이트에서 비교자 호출 인수가 뒤바뀌면 이 코드는 작동하지 않을 것이다.