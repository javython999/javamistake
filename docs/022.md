# 멱등 루프 본문
멱등 연산이란 한 번 수행하든 여러 번 수행하든 동일한 부수 효과를 낳는 연산을 의미한다.
```java
int x = 0; // 멱등

int x += 10 // 멱등성이 없는 연산
```
루프 안에서 반복적으로 실행되는 모든 코드는 멱등하지 않아야 한다.
'모든 코드'란 for 루푸의 경우 루프 본문, 루프 조거느 증감 코드 등을 말한다.
이 원칙이 지켜지지 않는 루프는 버극 ㅏ있을 가능성이 높다.

```java
while (condition) {
    ...
}
```
이 루프의 조건에 부수 효과가 없고 본문이 멱등하다고 가정해보자.
발생할 수 있는 상황은 세 가지다.

1. 조건이 처음부터 거짓이다.
2. 조건이 처음에는 참이었지만 본문을 거치며 거짓으로 바뀐다.
3. 조건이 처음부터 참이고 본문에서 변경하지 않는다.

```java
static String makeUniqueId(String id, Set<String> usedIds) {
    int i = 1;
    String uniqueId = id;
    while (usedIds.contains(uniqueId)) {
        uniqueId = id + "_" + i;
    }
    return uniqueId;
}
```
이 코드의 루프의 본문은 멱등성을 띠며 조건에 부수 효과가 없다는 것을 알 수 있다.
id와 i는 루프 본문에서 변경되지 않고 접미사도 _2, _3처럼 바뀌지 않는다.

> 실수 방지 가이드

* 루프의 유닛 테스트를 작성할 때 0과 1뿐만 아니라 그 이상의 회차도 테스트에 포함한다. 루프는 두 번이상 순회하기 위해 존재하므로(그렇지 않으면 조건문에 불과함) 테스트도 두 번이상 반복되는 시나리오에 대응해야 한다.
* `indexOf()` 등의 메서드로 문자열을 처리할 때 특히 주의한다. ch 문자열을 차례로 찾을 때 쓰는 `pos = str.indexOf(ch, pos)`는 매우 일반적인 코드 패턴이다. 그러나 pos를 갱싱하지 않는 분기가 존재한다면 무한 루프에 빠질 위험이 있다.