# null 사용 불가 스트림에서 null 값 사용
스트림 내부의 `null` 값은 주의 깊게 다뤄야 한다.
일반적으로 스트림은 `null`을 허용하지만 단말 연산은 `null`을 허용하지 않는 경우가 있다.
`findFirst()`는 첫번째 원소가 `null`일 때 `NullPointerException`을 던진다.
`findFirst()`는 `Optional`을 반환하며 `Optional`은 `null` 값을 담을 수 없기 때문이다.
비어 있는 `Optional`은 스트림이 비어있음을 나타낸다.
`max()`, `min()`, `reduce(accumulator)` 등의 단말 연산도 이와 비슷한 방식으로 `Optional`을 활용한다.
스트림에 포함된 `null`을 중간 연산에서 기꺼이 처리하지만 최종 결과가 `null`이면 예외를 던진다.

흥미로운 점은, `maxBy()`와 `minBy()` 등의 표준 수집기는 `max()` 및 `min()` 등의 단말 연산과 다르게 작동하는 것이다.
최종 결과가 `null`일 때 이들은 예외를 던지지 않고 다음 코드처럼 빈 `Optional`을 반환한다.

```java
List<Integer> list = Arrays.asList(null, 1, 2);
var comparator = Comparator.<Integer>nullsLast(Comparator.naturalOrder());
System.out.println(list.stream().collect(Collectors.maxBy(comparator)));
System.out.println(list.stream().max(comparator));
```
그러나 모든 수집기가 `null`을 허용하는 것은 아니다.
`toList()`와 `set()`은 스트림에 포함된 `null`을 허용하면 `toMap()`은 허용하지 않는다.
따라서 `toMap()`에 전달하는 매핑 함수는 `null`을 반환하면 안 된다.
한편 `groupingBy()` 수집기는 `null` 값을 허용하며 `null` 키는 허용하지 않는다.
이처럼 스트림과 `null` 값의 관계에는 다양한 함정이 숨어 있다.

>실수 방지 가이드
* 가능한 한 스트림에 `null`을 담지 않는다.
특히 스트림 단말 연산 직전에 `null`이 등장하지 않도록 주의한다.
스트림에 `null`이 등장할 때 이를 즉시 제거할 수 있는 가장 일반적인 패턴은 `filter(Object::nonNull)`이다.
* 불가피한 이유로 단말 연산에 `null`을 전달해야 한다면 해당 연산이나 수집기의 공식 문서를 자세히 검토한다.
그래도 확신이 서지 않으면 별도의 소형 프로그램이나 JShell 콘솔을 통해 해당 단말 연산이 null이 어떻게 반흥하는지 테스트 한다.
예를 들어, 첫 번째 스트림 원소가 `null`일떄`findFirst()`가 어떻게 작동하는지 확인하려면 JShell 콘솔에 담은을 입력해보면 된다.
```java
Stream.of((Object) null).findFirst();
```
비어있는 Optional이 반환되는 대신 `NullPointerException`이 즉시 발생할 것이다.